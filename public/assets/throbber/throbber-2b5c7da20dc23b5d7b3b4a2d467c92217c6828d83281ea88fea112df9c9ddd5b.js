/**
 * @preserve throbber.js v 0.0.2 2014-04-30
 * http://aino.com
 *
 * Copyright (c) Aino Aktiebolag
 * Licensed under the MIT license.
 *
 */
!function(global,factory){"object"==typeof module&&"object"==typeof module.exports?module.exports=factory(global):"function"==typeof define&&define.amd?define("throbber",[],function(){return factory(global)}):global.Throbber=factory(global)}(window||this,function(window){function Throbber(options){if(!(this instanceof Throbber))return new Throbber(options);var elem=this.elem=document.createElement("canvas"),scope=this;isNaN(options)||(options={size:options}),this.o={size:34,rotationspeed:6,clockwise:!0,color:"#fff",fade:300,fallback:!1,alpha:1},this.configure(options),this.phase=-1,support?(this.ctx=elem.getContext("2d"),elem.width=elem.height=this.o.size):this.o.fallback&&(elem=this.elem=new Image,elem.src=this.o.fallback),this.loop=function(){var o=scope.o,alpha=0,fade=1e3/o.fade/o.fps,step=(1e3/o.fps,scope.step),style=elem.style,currentStyle=elem.currentStyle,ie=(currentStyle&&currentStyle.filter||style.filter,"filter"in style&&o.fallback&&!support);return function(){3==scope.phase&&(alpha-=fade,alpha<=0&&(scope.phase=0)),1==scope.phase&&(alpha+=fade,alpha>=1&&(scope.phase=2)),ie?style.filter="alpha(opacity="+M.min(100*o.alpha,M.max(0,Math.round(100*alpha)))+")":!support&&o.fallback?style.opacity=alpha:support&&(_draw(alpha,o,scope.ctx,step),step=0===step?scope.o.lines:step-1)}}(),_animate(this.o.fps,this.loop)}var fade,i,l,ad,rd,document=window.document,M=Math,support=(window.setTimeout,"getContext"in document.createElement("canvas")),_extend=function(defaults,obj){defaults=defaults||{};for(var i in obj)defaults[i]=obj[i];return defaults},_animate=function(){function tick(){requestFrame(tick);for(var now=+new Date,i=0;i<loops.length;i++){var loop=loops[i];loop.elapsed=now-loop.then,loop.elapsed>loop.fpsInterval&&(loop.then=now-loop.elapsed%loop.fpsInterval,loop.fn())}}var loops=[],animating=!1,requestFrame=function(){var r="RequestAnimationFrame";return window.requestAnimationFrame||window["webkit"+r]||window["moz"+r]||window["o"+r]||window["ms"+r]||function(callback){window.setTimeout(callback,1e3/60)}}();return function(fps,draw){var now=+new Date;loops.push({fpsInterval:1e3/fps,then:now,startTime:now,elapsed:0,fn:draw}),animating||(animating=!0,tick())}}(),_getRGB=function(color){if(!support)return{rgb:!1,alpha:1};var rgb,t=document.createElement("i");return t.style.display="none",t.style.color=color,document.body.appendChild(t),rgb=window.getComputedStyle(t,null).getPropertyValue("color").replace(/^rgba?\(([^\)]+)\)/,"$1").replace(/\s/g,"").split(",").splice(0,4),document.body.removeChild(t),t=null,{alpha:4==rgb.length?rgb.pop():1,rgb:rgb}},_restore=function(ctx,size,back){var n=back?-2:2;ctx.translate(size/n,size/n)},_draw=function(alpha,o,ctx,step){fade=1-alpha||0,ad=1,rd=-1;var size=o.size;for(o.clockwise===!1&&(ad=-1,rd=1),ctx.clearRect(0,0,size,size),ctx.globalAlpha=o.alpha,ctx.lineWidth=o.strokewidth,i=0;i<o.lines;i++)l=i+step>=o.lines?i-o.lines+step:i+step,ctx.strokeStyle="rgba("+o.color.join(",")+","+M.max(0,l/o.lines-fade).toFixed(2)+")",ctx.beginPath(),ctx.moveTo(size/2,size/2-o.padding/2),ctx.lineTo(size/2,0),ctx.lineWidth=o.strokewidth,ctx.stroke(),_restore(ctx,size,!1),ctx.rotate(ad*(360/o.lines)*M.PI/180),_restore(ctx,size,!0);o.rotationspeed&&(ctx.save(),_restore(ctx,size,!1),ctx.rotate(rd*(360/o.lines/(20-2*o.rotationspeed))*M.PI/180),_restore(ctx,size,!0))};return Throbber.prototype={constructor:Throbber,appendTo:function(elem){return this.elem.style.display="none",elem.appendChild(this.elem),this},configure:function(options){var color,o=this.o;return _extend(o,options||{}),color=_getRGB(o.color),_extend(o,_extend({padding:o.size/2,strokewidth:M.max(1,M.min(o.size/30,3)),lines:M.min(30,o.size/2+4),alpha:color.alpha||1,fps:M.min(30,o.size+4)},options)),o.color=color.rgb,this.step=o.lines,window.devicePixelRatio&&(this.elem.style.width=o.size+"px",this.elem.style.height=o.size+"px",o.size*=window.devicePixelRatio,o.padding*=window.devicePixelRatio,o.strokewidth*=window.devicePixelRatio),this},start:function(){return this.elem.style.display="block",this.phase==-1&&this.loop(),this.phase=1,this},stop:function(){return this.phase=3,this},toggle:function(){2==this.phase?this.stop():this.start()}},Throbber});